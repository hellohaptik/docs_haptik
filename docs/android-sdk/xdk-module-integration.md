---
title: Integrating XDK Module
---

<AUTOGENERATED_TABLE_OF_CONTENTS>

## Introduction

Haptik XDK is a lightweight SDK for consuming capabilities of Haptik platform. It contains minimal functionality to get started on Haptik's platform with simple, object oriented interfaces

## Permissions

Haptik XDK module will add the following permissions to your app, this is to support all the features in the Haptik XDK.

- “INTERNET” (For making the NETWORK CALLS)
- “ACCESS_NETWORK_STATE” (Check if the device is connected to the INTERNET)
- “WAKE_LOCK” (MQTT)

## Adding Gradle Dependencies

First of all, you need to do maven repository setup in your root `build.gradle` for our XDK, and
some of our internal dependencies.
For Haptik XDK

```groovy
maven {
    url "https://artifactory.hellohaptik.com/artifactory/libs-release-local"
    credentials {
        username "<ASK HAPTIK FOR USERNAME>"
        password "<ASK HAPTIK FOR PASSWORD>"
    }
}
```

Add the following in module `build.gradle` for eg: `build.gradle (Module: app)`

```groovy
implementation 'ai.haptik.android.sdk:haptiklib-xdk:6.5.1-65283'
```

## Target Android SDK 28

If you are targeting **Android Version 28**, please create an xml resource file `network_security_config.xml` (if not created already) and add the below lines. This is needed so that Haptik specific images which are hosted in non-secure connection can be loaded properly.

```xml
<?xml version="1.0" encoding="utf-8"?>
<network-security-config>
    .
    .
    .
    <!--Haptik Specific configuration-->
    <domain-config cleartextTrafficPermitted="true">
        <domain includeSubdomains="true">haptik-staging.s3.amazonaws.com</domain>
        <domain includeSubdomains="true">haptikapi.com</domain>
        <domain includeSubdomains="true">haptikdev.s3.amazonaws.com</domain>
        <domain includeSubdomains="true">staging.hellohaptik.com</domain>
    </domain-config>
  .
  .
  .
</network-security-config>
```

Now add the following line in your app's `AndroidManifest.xml` file:

```xml
<manifest xmlns:android="http://schemas.android.com/apk/res/android"
    xmlns:tools="http://schemas.android.com/tools"
    .
    .
    .
    <application android:networkSecurityConfig="@xml/network_security_config">
    .
    .
    .
</manifest>
```

You can find more details about it [here in Google's Blog.](https://android-developers.googleblog.com/2018/04/protecting-users-with-tls-by-default-in.html)

## Initialize Haptik XDK

Before using any functionality in the Haptik XDK it is important to initialize the Haptik XDK.
Follow the steps below to successfully initialize the Haptik XDK

You should put the following code in the `onCreate()` method of your `Application` class

For production environment use following code :
```kotlin
 HaptikLib.init(Settings(applicationContext)
     .baseUrl(PROD_BASE_URL_PROVIDED_BY_HAPTIK)
     .clientId(CLIENT_ID_PROVIDED_BY_HAPTIK))
```

For staging environment use following code :
```kotlin
 HaptikLib.init(Settings(applicationContext)
     .baseUrl(STAGING_BASE_URL_PROVIDED_BY_HAPTIK)
     .clientId(CLIENT_ID_PROVIDED_BY_HAPTIK)
     .stagingEnv())
```

NOTE: Please make sure you have initialized Haptik XDK before using any functionality of Haptik XDK.

## Sign Up User

Before signing up user, please ensure Haptik lib is initialized.

For singing up user you need to use following code :

```kotlin
HaptikLib.performGuestSignUp(object : Callback<User> {
    override fun success(result: User) {
        Toast.makeText(context, "Sing up success", Toast.LENGTH_LONG).show()
    }

    override fun failure(exception: Exception) {
         Toast.makeText(context, "Sign up failed", Toast.LENGTH_LONG).show()
    }
})
```

In case you want to pass on some details of user like name, phone number and email id you need to pass `SingUpData` object. These details
 will help in customizing user experience. Use the following code to configure the `SignUpData`.

```kotlin
val signUpData = SignUpData(SignUpData.AUTH_TYPE_BASIC)
                    .userEmail("email")
                    .userPhone("97347343")
                    .userFullName("name")

HaptikLib.performGuestSignUp(signUpData, object : Callback<User> {
    override fun success(result: User) {
        Toast.makeText(context, "Sing up success", Toast.LENGTH_LONG).show()
    }

    override fun failure(exception: Exception) {
         Toast.makeText(context, "Sign up failed", Toast.LENGTH_LONG).show()
    }
})
```

## Handling Messaging

### Incoming Messages
To get notified about incoming messages you need to implement `MessageListener` and register it with XDK. Most probably you want to 
implement this in your conversation activity.

```kotlin
class ConversationScreen : AppCompatActivity(), MessageStore.MessageListener {

    override fun onMessageReceived(messageJson: JSONObject) {
        // Parse bot message from messageJson
    }
    
    override fun onStart() {
        super.onStart()
        MessageStore.addMessageListener(this)
    }
    
    override fun onStop() {
        super.onStop()
        MessageStore.removeListeners(this)
    }
}
```

### Sending Messages
To send message you need to call `sendMessage()` method of MessageStore. You need to pass message string and id of respective channel.

```kotlin
MessageStore.sendMessage("YOUR MESSAGE", CHANNEL_ID, object : Callback<JsonArray> {
    override fun success(result: JsonArray) {
        Toast.makeText(context, "Message sent success", Toast.LENGTH_LONG).show()
    }

    override fun failure(exception: Exception) {
        Toast.makeText(context, "Message sending failure", Toast.LENGTH_LONG).show()
    }
})
```